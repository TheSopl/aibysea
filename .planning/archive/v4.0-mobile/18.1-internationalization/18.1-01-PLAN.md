---
phase: 18.1-internationalization
plan: 01
type: execute
---

<objective>
Set up next-intl infrastructure and restructure app for locale-based routing.

Purpose: Establish the i18n foundation (middleware, routing, fonts) that all translations depend on.
Output: Working [locale] routing with EN/TR/AR support, Arabic font loaded, next-intl configured.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18.1-internationalization/18.1-RESEARCH.md

**Key files:**
@src/app/layout.tsx
@next.config.ts

**From research:**
- Use next-intl (^3.22+) - purpose-built for App Router
- IBM Plex Sans Arabic font for Arabic glyphs
- Middleware routing with [locale] dynamic segment
- `localePrefix: 'as-needed'` - only prefix non-default locales

**Critical patterns from RESEARCH.md:**
- routing.ts defines locales and defaultLocale
- navigation.ts exports locale-aware Link, useRouter, usePathname
- request.ts configures message loading
- middleware.ts handles locale detection
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install next-intl and create i18n configuration</name>
  <files>package.json, src/i18n/routing.ts, src/i18n/navigation.ts, src/i18n/request.ts, next.config.ts</files>
  <action>
1. Install next-intl: `npm install next-intl`
2. Create src/i18n/routing.ts:
   - Define locales: ['en', 'tr', 'ar']
   - Set defaultLocale: 'en'
   - Use localePrefix: 'as-needed'
3. Create src/i18n/navigation.ts:
   - Export Link, redirect, usePathname, useRouter, getPathname from createNavigation
4. Create src/i18n/request.ts:
   - Use getRequestConfig to load messages from ../messages/${locale}.json
   - Validate locale against routing.locales
5. Update next.config.ts:
   - Import createNextIntlPlugin from 'next-intl/plugin'
   - Wrap config with withNextIntl('./src/i18n/request.ts')

**Avoid:** Do NOT use next-i18next (incompatible with App Router). Do NOT manually detect locale - let middleware handle it.
  </action>
  <verify>npm run build completes without errors, next.config.ts exports withNextIntl wrapper</verify>
  <done>next-intl installed, all 3 i18n config files created, next.config.ts updated</done>
</task>

<task type="auto">
  <name>Task 2: Restructure app for [locale] routing and add middleware</name>
  <files>src/middleware.ts, src/app/[locale]/layout.tsx, src/app/[locale]/(main)/layout.tsx, src/app/layout.tsx</files>
  <action>
1. Create/update src/middleware.ts:
   - Import createMiddleware from 'next-intl/middleware'
   - Import routing from './i18n/routing'
   - Export default createMiddleware(routing)
   - Add config.matcher to exclude api, _next, static files

2. Move src/app/layout.tsx to src/app/[locale]/layout.tsx:
   - Add params: { locale } to props
   - Call setRequestLocale(locale) at top for static rendering
   - Set html lang={locale} dir={locale === 'ar' ? 'rtl' : 'ltr'}
   - Import NextIntlClientProvider and wrap children with messages
   - Add IBM_Plex_Sans_Arabic font with subsets: ['arabic'], weight: ['400', '500', '600', '700']
   - Add font CSS variable (--font-arabic) to html className
   - Add generateStaticParams() returning routing.locales.map

3. Create minimal src/app/layout.tsx as passthrough:
   - Just return {children} - the [locale] layout handles everything

4. Move src/app/(main)/layout.tsx to src/app/[locale]/(main)/layout.tsx:
   - No changes needed - this is a client component using client-side navigation

5. Create empty messages files for now (to prevent build errors):
   - src/messages/en.json: { "Common": { "appName": "AI BY SEA" } }
   - src/messages/tr.json: { "Common": { "appName": "AI BY SEA" } }
   - src/messages/ar.json: { "Common": { "appName": "AI BY SEA" } }

**Critical:** Ensure all page.tsx and layout.tsx files are moved to [locale] segment. The (main) route group moves inside [locale].

**Avoid:** Do NOT forget setRequestLocale in layouts - causes static rendering issues. Do NOT use next/navigation - use @/i18n/navigation for Link, useRouter, usePathname.
  </action>
  <verify>npm run dev starts without errors, visiting / redirects to correct locale, visiting /tr shows Turkish locale in html lang attribute</verify>
  <done>Middleware routing works, [locale] segment in place, Arabic font loaded, RTL dir set for Arabic</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run dev` starts and loads without errors
- [ ] Visiting http://localhost:3000 redirects to /en or stays without prefix (as-needed)
- [ ] Visiting http://localhost:3000/tr loads with `lang="tr" dir="ltr"`
- [ ] Visiting http://localhost:3000/ar loads with `lang="ar" dir="rtl"`
- [ ] No TypeScript errors in i18n files
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- next-intl infrastructure fully configured
- [locale] routing working for EN/TR/AR
- Arabic font loaded for RTL content
</success_criteria>

<output>
After completion, create `.planning/phases/18.1-internationalization/18.1-01-SUMMARY.md`:

# Phase 18.1 Plan 01: i18n Infrastructure Summary

**[Substantive one-liner]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `src/i18n/routing.ts` - Locale configuration
- `src/i18n/navigation.ts` - Locale-aware navigation exports
- `src/i18n/request.ts` - Message loading config
- `src/middleware.ts` - Locale detection and routing
- `src/app/[locale]/layout.tsx` - Locale layout with RTL
- `next.config.ts` - next-intl plugin

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 18.1-02-PLAN.md (Translation Files & Navigation)
</output>
