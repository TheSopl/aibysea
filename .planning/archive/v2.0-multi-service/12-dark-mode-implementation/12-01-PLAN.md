# Plan 12-01: Fix Tailwind v4 Dark Mode Configuration

**Phase:** 12 - Dark Mode Implementation
**Created:** 2026-01-16
**Status:** Not Started

## Context

The theme toggle UI is implemented (ThemeContext + toggle button) but doesn't actually change page colors. Root cause: Tailwind v4 requires `@variant dark` directive in CSS to generate dark mode utility classes. Without this directive, all `dark:bg-*` and `dark:text-*` classes are ignored by Tailwind.

**Current state:**
- ✅ ThemeContext working (manages state, updates localStorage, toggles DOM `.dark` class)
- ✅ CSS variables defined for light and dark themes
- ✅ Blocking script in layout.tsx prevents flash
- ❌ Missing `@variant dark` directive → Tailwind doesn't generate dark: utility classes
- ❌ Components use hardcoded colors (`bg-white`, `text-dark`) instead of theme-aware classes

**User requirement:** Toggle button must work - clicking it should immediately change all page colors. Dark mode should use dark slate blue background (#0f172a) with white text, matching the `/documents` page styling.

**Reference:** `.planning/phases/12-dark-mode-implementation/12-RESEARCH.md`

## Objective

Enable Tailwind v4 dark mode variant generation and verify the theme toggle works end-to-end before updating individual components.

## Success Criteria

- [ ] `@variant dark` directive added to globals.css
- [ ] Tailwind generates dark: utility classes (verified with dev tools)
- [ ] Theme toggle changes at least one component's colors (test case)
- [ ] No CSS errors or build failures
- [ ] Theme preference persists across page reloads

## Tasks

### Task 1: Add @variant dark directive to globals.css

**What:** Add the Tailwind v4 dark mode variant directive to enable dark: utility classes.

**Why:** Without this directive, Tailwind v4 doesn't generate any dark: prefixed classes, making all dark mode styling impossible.

**How:**
1. Open `src/app/globals.css`
2. Add `@variant dark (&:where(.dark, .dark *));` immediately after the `@import "tailwindcss";` line
3. Verify CSS structure:
   ```css
   @import "tailwindcss";

   /* Enable dark mode variant */
   @variant dark (&:where(.dark, .dark *));

   /* Existing :root and html.dark variables below... */
   ```

**Files:**
- `src/app/globals.css` - Add directive after line 1

**Validation:**
- CSS file has no syntax errors
- Dev server restarts successfully
- Browser console shows no CSS errors

**Reference:** 12-RESEARCH.md lines 67-72 (Pattern 1: Tailwind v4 CSS Configuration)

---

### Task 2: Create test component to verify dark mode works

**What:** Add a simple test element to TopBar with dark mode classes to verify Tailwind is generating them.

**Why:** Before updating all pages, we need to confirm the `@variant dark` directive actually works. A visible test confirms the fix.

**How:**
1. Open `src/components/layout/TopBar.tsx`
2. Add a test div with both light and dark mode classes:
   ```tsx
   {/* Dark mode test - remove after verification */}
   <div className="bg-white dark:bg-slate-800 text-black dark:text-white px-3 py-1 rounded border border-gray-200 dark:border-slate-600 text-sm">
     Theme: {theme}
   </div>
   ```
3. Position it near the theme toggle button (inside the right actions div)
4. Click theme toggle and verify:
   - Light mode: white background, black text, gray border
   - Dark mode: slate-800 background, white text, slate-600 border

**Files:**
- `src/components/layout/TopBar.tsx` - Add test div in right actions section (around line 31)

**Validation:**
- Test div is visible in UI
- Clicking theme toggle changes the div's colors immediately
- Background, text, and border all change as expected
- Theme label shows correct value ('light' or 'dark')

**Note:** This is a temporary test element - will be removed once we confirm dark mode works.

---

### Task 3: Verify theme persistence and blocking script

**What:** Test that theme preference persists across page reloads and no flash occurs.

**Why:** Ensures the SSR setup is working correctly - theme loads instantly without showing wrong colors.

**How:**
1. Set theme to dark mode (click toggle)
2. Verify test div shows dark colors
3. Hard refresh page (Ctrl+Shift+R)
4. Observe page load - should be dark immediately, no flash of light mode
5. Check localStorage in dev tools - should show `theme: "dark"`
6. Switch to light mode, repeat steps 2-5

**Files:**
- None (testing existing implementation)

**Validation:**
- Theme persists after hard refresh
- No flash of wrong colors during page load
- localStorage contains correct theme value
- Blocking script in layout.tsx executes before React hydrates
- No console warnings about hydration mismatch

**Reference:** 12-RESEARCH.md lines 94-122 (Pattern 2: Blocking Script for Flash Prevention)

---

### Task 4: Remove test component

**What:** Remove the temporary test div from TopBar once verification is complete.

**Why:** Clean up test code before moving to component updates in next plan.

**How:**
1. Open `src/components/layout/TopBar.tsx`
2. Remove the test div added in Task 2
3. Verify TopBar still renders correctly without it

**Files:**
- `src/components/layout/TopBar.tsx` - Remove test div

**Validation:**
- TopBar UI looks correct (no test element visible)
- Theme toggle still works
- No console errors

---

## Implementation Notes

**Critical:** Do NOT update component classes in this plan. This plan ONLY:
1. Fixes Tailwind v4 configuration (@variant directive)
2. Verifies the fix works (test component)
3. Confirms SSR persistence works

Converting components to use dark mode classes (changing `bg-white` to `bg-white dark:bg-slate-800` etc.) will be in Plan 12-02.

**Why separate?** If we update components before fixing Tailwind config, we'll see no change and won't know if the issue is config or classes. Fix foundation first, then build on it.

## Risk Assessment

**Low Risk:**
- Adding `@variant dark` is standard Tailwind v4 syntax
- Test component is isolated and temporary
- No changes to existing component styling in this plan

**Rollback:**
- If @variant directive causes CSS errors, remove it and investigate
- Test component can be removed immediately if it causes issues

## Dependencies

**Requires:**
- Tailwind CSS v4.1.18 (already installed)
- ThemeContext implementation (already exists)
- Blocking script in layout.tsx (already exists)

**Blocks:**
- Plan 12-02: Update component dark mode classes (can't work without @variant directive)

## Estimated Scope

**Tasks:** 4
**Files modified:** 2 (globals.css, TopBar.tsx)
**Complexity:** Low (configuration + verification)

## Completion Checklist

- [ ] Task 1: @variant dark directive added to globals.css
- [ ] Task 2: Test component added and visible in TopBar
- [ ] Task 3: Theme toggle changes test component colors
- [ ] Task 4: Theme persists across hard refresh with no flash
- [ ] Task 5: Test component removed from TopBar
- [ ] Plan review: All tasks completed successfully
- [ ] Ready for Plan 12-02: Component dark mode class updates

---

**Next:** Plan 12-02 will systematically update all pages (dashboard, inbox, documents, processing, data) to use dark mode classes, matching the `/documents` page reference styling.
