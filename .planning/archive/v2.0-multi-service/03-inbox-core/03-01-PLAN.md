---
phase: 03-inbox-core
plan: 01
type: execute
---

<objective>
Replace placeholder sidebar with live conversation list from database.

Purpose: Agents see all conversations with recent messages, sorted by last activity.
Output: Sidebar showing real conversations from WhatsApp and Telegram.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-whatsapp-integration/02-03-SUMMARY.md
@.planning/phases/02.1-telegram-integration/02.1-01-SUMMARY.md
@src/types/database.ts
@src/components/Sidebar.tsx
@src/app/dashboard/layout.tsx
@src/lib/supabase/server.ts

**Tech stack available:**
- Next.js 16 with Turbopack
- Supabase SSR client for server components
- Tailwind CSS for styling

**Established patterns:**
- Server components fetch data directly with `createClient()`
- Database types in `src/types/database.ts`
- Conversations have `channel` field ('whatsapp' or 'telegram')
- Contacts store `phone` (whatsapp number or telegram:{chat_id})
- `last_message_at` for sorting conversations
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create conversation list component with DB query</name>
  <files>src/components/ConversationList.tsx, src/components/ConversationItem.tsx</files>
  <action>
Create server component that fetches conversations with joined contact data:

**ConversationList.tsx:**
- Use `createClient()` from server to query conversations
- Join with contacts table to get contact name/phone
- Join with messages to get last message preview (limit 1)
- Order by `last_message_at DESC`
- Query: `conversations` with `contact:contacts(id, name, phone)` and last message

**ConversationItem.tsx:**
- Client component (needs onClick for navigation)
- Display: Contact name (or phone if no name), channel icon, last message preview, timestamp
- Channel icons: WhatsApp = green phone icon, Telegram = blue paper plane
- Truncate message preview to 1 line
- Format timestamp: "Just now", "5m", "2h", "Yesterday", or date
- Use `useRouter` for navigation to `/dashboard/c/[id]`

**Styling:**
- Full-width items with hover state (bg-gray-100)
- Unread indicator (if status is 'active' and handler_type is 'ai') - blue dot
- Padding: px-4 py-3
- Border-bottom between items
  </action>
  <verify>npm run build succeeds; ConversationList renders without errors</verify>
  <done>ConversationList fetches and displays conversations from database</done>
</task>

<task type="auto">
  <name>Task 2: Integrate conversation list into sidebar</name>
  <files>src/components/Sidebar.tsx</files>
  <action>
Replace placeholder content with ConversationList component:

- Import and render ConversationList in the scrollable area
- Keep header "Conversations" with styling
- Add search input placeholder above list (UI only, no functionality yet)
- Wrap in Suspense with loading skeleton

**Loading skeleton:**
- 5 items with animated pulse
- Rectangle for avatar, two lines for name/message

Keep sidebar width at w-80 (320px).
  </action>
  <verify>Sidebar shows real conversations (or empty state if no data)</verify>
  <done>Sidebar displays live conversation list from database</done>
</task>

<task type="auto">
  <name>Task 3: Create conversation route placeholder</name>
  <files>src/app/dashboard/c/[id]/page.tsx</files>
  <action>
Create route for individual conversation view:

**src/app/dashboard/c/[id]/page.tsx:**
- Server component that receives `params.id`
- Fetch conversation + contact info from database
- Display: "Conversation with {contact name}" heading
- Placeholder: "Messages will appear here"
- This is preparation for Plan 02 (message view)

Route structure: /dashboard/c/[id] where id is conversation UUID.
  </action>
  <verify>Navigate to /dashboard/c/[uuid] shows placeholder page</verify>
  <done>Conversation route exists and displays contact name</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] Sidebar shows conversations from database (test with existing Telegram data)
- [ ] Clicking conversation navigates to /dashboard/c/[id]
- [ ] Empty state shows when no conversations exist
- [ ] Channel icons distinguish WhatsApp from Telegram
</verification>

<success_criteria>

- All 3 tasks completed
- All verification checks pass
- Conversations visible in sidebar with real data
- Navigation to conversation detail works
</success_criteria>

<output>
After completion, create `.planning/phases/03-inbox-core/03-01-SUMMARY.md` following the summary template.
</output>
