---
phase: 03-inbox-core
plan: 02
type: execute
---

<objective>
Build conversation view showing message history in chat bubble format.

Purpose: Agents see full conversation history with a customer in chronological order.
Output: Message thread display with proper styling for inbound/outbound messages.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-inbox-core/03-01-PLAN.md
@src/types/database.ts
@src/app/dashboard/c/[id]/page.tsx

**Database schema (messages table):**
- `direction`: 'inbound' (customer) or 'outbound' (agent/AI)
- `content`: message text
- `content_type`: 'text' for now
- `sender_type`: 'customer', 'agent', or 'ai'
- `created_at`: timestamp

**Established patterns:**
- Server components for data fetching
- Client components for interactivity
- Tailwind for styling
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create message list component</name>
  <files>src/components/MessageList.tsx, src/components/MessageBubble.tsx</files>
  <action>
Create chat message display components:

**MessageList.tsx (Server Component):**
- Accept `conversationId` prop
- Fetch messages ordered by `created_at ASC` (oldest first)
- Pass to client component for rendering
- Include sender_type to show "AI" badge on AI messages

**MessageBubble.tsx (Client Component):**
- Accept message object prop
- Style based on direction:
  - Inbound (customer): Left-aligned, gray background (bg-gray-100), rounded-lg rounded-tl-none
  - Outbound (agent/AI): Right-aligned, blue background (bg-blue-500 text-white), rounded-lg rounded-tr-none
- Show timestamp below bubble (text-xs text-gray-400)
- If sender_type is 'ai', show small "AI" badge
- Max-width: 70% of container

**Layout:**
- Messages in flex column with gap-2
- Scroll container with overflow-y-auto
- Padding: p-4
  </action>
  <verify>MessageList renders with mock data; bubbles styled correctly</verify>
  <done>Message bubbles display with proper inbound/outbound styling</done>
</task>

<task type="auto">
  <name>Task 2: Build conversation page layout</name>
  <files>src/app/dashboard/c/[id]/page.tsx</files>
  <action>
Replace placeholder with full conversation view:

**Page structure:**
```
┌─────────────────────────────────────┐
│ Header: Contact name + channel icon │
├─────────────────────────────────────┤
│                                     │
│ Message List (scrollable)           │
│                                     │
├─────────────────────────────────────┤
│ Compose area (placeholder for 03-03)│
└─────────────────────────────────────┘
```

**Header:**
- Contact name (fallback to phone)
- Channel icon (WhatsApp/Telegram)
- "Handled by: AI" or "Handled by: {agent name}" badge

**Compose placeholder:**
- Gray bar at bottom with text "Message compose coming next..."
- Height: 60px

**Data fetching:**
- Fetch conversation with contact join
- Pass conversation_id to MessageList
- Handle 404 if conversation not found
  </action>
  <verify>Conversation page shows header, messages, and compose placeholder</verify>
  <done>Conversation page layout complete with message history</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Conversation view with message history display</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:3000/dashboard
    3. Click on a conversation in the sidebar (must have Telegram test messages)
    4. Verify:
       - Header shows contact name and channel icon
       - Messages appear in chronological order
       - Inbound messages on left (gray), outbound on right (blue)
       - Timestamps visible below bubbles
       - Scroll works if many messages
    5. If no conversations, send a Telegram message to test bot first
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] Conversation page displays message history
- [ ] Inbound/outbound messages styled differently
- [ ] Header shows contact info and handler status
- [ ] Human verification passed
</verification>

<success_criteria>

- All tasks completed including human verification
- Message history displays correctly
- Page layout matches specification
</success_criteria>

<output>
After completion, create `.planning/phases/03-inbox-core/03-02-SUMMARY.md` following the summary template.
</output>
