---
phase: 13-conversational-core
plan: 01
type: execute
---

<objective>
Verify the existing Conversational Core functionality works end-to-end.

Purpose: Confirm that the v1.0 infrastructure (WhatsApp/Telegram webhooks, message sending, AI integration, real-time updates) is fully functional before proceeding to Phase 14.
Output: Verified message flow with human testing, documented as working.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md

**Prior Implementation (v1.0):**
The conversational core was fully implemented in Phases 2-6 of v1.0:
- Phase 2: WhatsApp integration (webhook, processor, client)
- Phase 2.1: Telegram integration (webhook, processor, client)
- Phase 3: Inbox UI (conversation list, message view)
- Phase 4: AI integration (n8n webhooks)
- Phase 5: Human takeover (UI and server actions)
- Phase 6: Real-time updates (Supabase subscriptions)

**Key Files:**
@src/app/api/webhooks/whatsapp/route.ts
@src/app/api/webhooks/telegram/[secret]/route.ts
@src/services/whatsapp/processor.ts
@src/services/telegram/processor.ts
@src/lib/whatsapp/client.ts
@src/lib/telegram/client.ts
@src/app/actions/messages.ts
@src/components/MessageListClient.tsx

**Environment Variables Required:**
- WHATSAPP_PHONE_NUMBER_ID
- WHATSAPP_ACCESS_TOKEN
- WHATSAPP_WEBHOOK_VERIFY_TOKEN
- WHATSAPP_APP_SECRET
- TELEGRAM_BOT_TOKEN
- TELEGRAM_WEBHOOK_SECRET
- N8N_WEBHOOK_SECRET
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify build and type safety</name>
  <files>package.json, tsconfig.json</files>
  <action>Run npm run build to confirm all conversational components compile without TypeScript errors. This validates the integration between WhatsApp/Telegram webhooks, processors, clients, and UI components.</action>
  <verify>npm run build completes with exit code 0, no TypeScript errors</verify>
  <done>Build succeeds, all conversational routes compile</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Existing Telegram message flow (inbound + outbound)</what-built>
  <how-to-verify>
    **Prerequisites:**
    - Ensure TELEGRAM_BOT_TOKEN is set in .env.local
    - Ensure TELEGRAM_WEBHOOK_SECRET is set in .env.local
    - Start dev server: npm run dev

    **Test Inbound Messages:**
    1. Open your Telegram app
    2. Find and message your bot (created via @BotFather)
    3. Send a test message: "Hello from Telegram"
    4. Check terminal logs for: [Telegram Processor] Processing message
    5. Visit http://localhost:3000/inbox
    6. Verify new conversation appears with the message

    **Test Outbound Messages:**
    7. Click on the Telegram conversation in inbox
    8. Type a reply in the compose box
    9. Click Send
    10. Verify message appears in your Telegram app
    11. Verify message appears in inbox UI with "You" indicator

    **Note:** If webhook isn't configured, use ngrok or similar to expose localhost and set webhook via setTelegramWebhook helper.
  </how-to-verify>
  <resume-signal>Type "telegram-verified" if both inbound and outbound work, or describe any issues</resume-signal>
</task>

<task type="checkpoint:human-verify" gate="optional">
  <what-built>Existing WhatsApp message flow (if Meta dashboard configured)</what-built>
  <how-to-verify>
    **Prerequisites:**
    - Meta Developer Dashboard configured with webhook URL
    - WHATSAPP_* environment variables set
    - Test phone number whitelisted in Meta dashboard

    **Test Inbound Messages:**
    1. Send a WhatsApp message to your business number
    2. Check terminal logs for: [WhatsApp Processor] Processing message
    3. Verify message appears in inbox

    **Test Outbound Messages:**
    4. Reply from inbox
    5. Verify message appears in WhatsApp

    **Skip if:** Meta dashboard not configured (deferred from Phase 2-03)
  </how-to-verify>
  <resume-signal>Type "whatsapp-verified" if working, "whatsapp-skip" if Meta not configured, or describe issues</resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Existing real-time message updates</what-built>
  <how-to-verify>
    1. Open inbox in browser: http://localhost:3000/inbox
    2. Open a conversation
    3. In another browser tab or your phone, send a new message to the bot
    4. Verify: New message appears in inbox WITHOUT page refresh
    5. Verify: Message list auto-scrolls to show new message
    6. Check for "Connection lost" banner - should NOT appear if connected
  </how-to-verify>
  <resume-signal>Type "realtime-verified" if messages appear live, or describe issues</resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Existing AI/Human takeover toggle</what-built>
  <how-to-verify>
    1. Open a conversation in inbox
    2. Look for the takeover button in conversation header
    3. If showing "AI Handling" (blue): Click to take over
    4. Verify button changes to "You're Handling" (orange)
    5. Verify conversation header indicator changes color
    6. Click again to return to AI handling
    7. Verify state toggles back

    Note: This tests the UI toggle only. AI responses require n8n workflow configuration.
  </how-to-verify>
  <resume-signal>Type "takeover-verified" if toggle works, or describe issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] Build succeeds without errors
- [ ] At least one channel (Telegram) tested end-to-end
- [ ] Real-time updates working
- [ ] Takeover toggle functioning
</verification>

<success_criteria>

- Build passes with no errors
- Telegram inbound/outbound verified (required)
- WhatsApp inbound/outbound verified (if configured) or explicitly skipped
- Real-time message updates confirmed working
- Human takeover toggle confirmed working
- Phase 13 ready to mark complete
  </success_criteria>

<output>
After completion, create `.planning/phases/13-conversational-core/13-01-SUMMARY.md`:

# Phase 13-01: Conversational Core Verification Summary

**[Verification outcome - e.g., "All core messaging functionality verified working"]**

## Verification Results

- Build: [PASS/FAIL]
- Telegram: [PASS/FAIL/SKIPPED]
- WhatsApp: [PASS/FAIL/SKIPPED]
- Real-time: [PASS/FAIL]
- Takeover: [PASS/FAIL]

## Issues Found

[Any issues discovered during verification, or "None"]

## Configuration Notes

[Any environment setup notes for future reference]

## Next Step

Phase 13 complete - proceed to Phase 14 (AI Agent Management)
</output>
