---
phase: 14-ai-agent-management
plan: 02
type: execute
---

<objective>
Connect the /agents page to real Supabase data and implement full agent configuration UI.

Purpose: Replace hardcoded demo agent with live database, enable creating/editing/deleting AI agents through the UI.
Output: Fully functional agent management page with create/edit modal, delete confirmation, and status toggle.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./14-02-SUMMARY.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-ai-agent-management/14-01-SUMMARY.md
@src/app/(main)/agents/page.tsx
@src/types/database.ts

**Prior context:**
- 14-01: ai_agents table and CRUD API created
- Existing page has hardcoded `agents` array with demo "Rashed" agent
- Page has stats overview, agent cards, and details panel
- Create Agent button exists but not wired
- Edit/Delete/Play/Pause buttons exist but not functional

**UI patterns established:**
- Modal dialogs for forms (see inbox page patterns)
- Optimistic updates with error rollback
- Toast notifications for success/error feedback
- Form validation with inline errors
</context>

<tasks>

<task type="auto">
  <name>Task 1: Connect /agents page to Supabase</name>
  <files>src/app/(main)/agents/page.tsx</files>
  <action>
Replace hardcoded `agents` array with Supabase fetch:
1. Add 'use client' is already present - convert to client-side fetch with useEffect
2. Create state: `agents`, `selectedAgent`, `loading`, `error`
3. Fetch from `/api/ai-agents` on mount
4. Update stats cards to use real data (or show 0 if empty)
5. Handle empty state gracefully - show "No agents yet" message with prominent Create button
6. Keep existing card layout and styling

Do NOT change the visual design - only the data source.
Remove the hardcoded photo path - use a default avatar or agent icon instead.
  </action>
  <verify>Page loads without errors, shows empty state or fetched agents</verify>
  <done>Agents list fetches from API, displays real data or empty state</done>
</task>

<task type="auto">
  <name>Task 2: Create agent form modal</name>
  <files>src/app/(main)/agents/page.tsx, src/components/agents/AgentFormModal.tsx</files>
  <action>
Create AgentFormModal component with fields:
- Name (text, required)
- Model (select: gpt-4-turbo, gpt-4, gpt-3.5-turbo, claude-3-opus, claude-3-sonnet)
- System Prompt (textarea, large)
- Greeting Message (textarea)
- Status (toggle: active/inactive)

Modal behavior:
- Opens on "Create Agent" button click (empty form)
- Opens on Edit button click (pre-filled form)
- Submit calls POST /api/ai-agents (create) or PATCH /api/ai-agents/[id] (update)
- Close on successful save, refresh agents list
- Show validation errors inline
- Show loading state on submit button

Wire Delete button:
- Show confirmation dialog: "Delete {agent.name}? This cannot be undone."
- On confirm, call DELETE /api/ai-agents/[id]
- Refresh list on success

Wire status toggle (Play/Pause buttons):
- PATCH /api/ai-agents/[id] with { status: 'active' | 'inactive' }
- Optimistic update with rollback on error

Style modal to match existing Purity UI aesthetic (rounded corners, gradients, shadows).
  </action>
  <verify>Create modal opens, form submits, agents list updates</verify>
  <done>Create/Edit/Delete all functional, status toggle works</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Full AI agent CRUD interface with modal forms, delete confirmation, and status toggle</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:3000/agents
    3. Test Create:
       - Click "Create Agent" button
       - Fill form: Name="Test Agent", Model="gpt-4-turbo", System Prompt="You are helpful"
       - Click Save - agent should appear in list
    4. Test Edit:
       - Click Edit icon on the agent card
       - Change name to "Updated Agent"
       - Save - name should update
    5. Test Delete:
       - Click Delete icon
       - Confirm deletion
       - Agent should disappear from list
    6. Test Status Toggle:
       - Click Pause icon - status should change to inactive
       - Click Play icon - status should change to active
    7. Check Details Panel:
       - Click on agent card
       - Details should show in right panel
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Agents page loads with real data from Supabase
- [ ] Create Agent opens modal, saves new agent
- [ ] Edit opens pre-filled modal, updates agent
- [ ] Delete shows confirmation, removes agent
- [ ] Status toggle changes active/inactive
- [ ] Empty state shows when no agents exist
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Human verification approved
- No TypeScript errors
- Full CRUD works through UI
- Ready for agent assignment in 14-03
</success_criteria>

<output>
After completion, create `.planning/phases/14-ai-agent-management/14-02-SUMMARY.md`
</output>
