---
phase: 07-ai-metrics-dashboard
plan: 03
type: auto
domain: data-visualization
---

<objective>
Build real-time metric charts showing latency, decision confidence, and context usage with memoized Recharts components.

Purpose: Show the CEO that the system is "thinking"—visualize intelligence metrics (latency over time, confidence distribution, context recall) with smooth, performant real-time updates.
Output: Three interactive charts with real-time data, memoized components preventing re-render storms, responsive to dashboard layout.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
.planning/phases/07-ai-metrics-dashboard/07-RESEARCH.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-ai-metrics-dashboard/07-RESEARCH.md

**Dependencies from Plan 01-02:**
- Tremor components for dashboard layout
- Recharts for charting (installed in 01, integrated here)
- Zustand metrics store with real-time data
- Metrics stream from Supabase Broadcast

**Key learning from RESEARCH.md:**
- Memoize chart components to skip re-renders when data hasn't changed
- Use custom comparators to detect meaningful changes (last data point different)
- Windowed chart data (show only last 100 points, not all 1000)
- Avoid creating new objects in render (breaks memoization)

**Files to reference:**
- `src/components/dashboard/AIMetricsDashboard.tsx` - Main layout
- `src/stores/metricsStore.ts` - Metrics data source
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create memoized LatencyChart component showing TTFT + TPOT</name>
  <files>src/components/dashboard/LatencyChart.tsx</files>
  <action>Create memoized Recharts LineChart showing latency metrics: TTFT (time to first token) in blue, TPOT (time per output token) in red. Chart displays last 100 data points from store.metrics (windowed). Use React.memo with custom comparator: only re-render if last data point changed (prevents re-render on every metric update). Use useMemo hook to transform store.metrics into chartData (last 100 points) outside of component. Do NOT create new objects in render function. Add XAxis (timestamp), YAxis (milliseconds), Tooltip, and Legend. Width 400px, height 300px. See RESEARCH.md code examples for memoization pattern.</action>
  <verify>Import into dashboard, render chart without errors. Open React DevTools Profiler: push mock metrics 20 times (via mock stream), chart should re-render 0-1 times (batching + memoization combined). No re-renders per update = memoization working.</verify>
  <done>Chart renders live latency data, memoization prevents re-render storms, data windowing at 100 points, chart displays both TTFT and TPOT</done>
</task>

<task type="auto">
  <name>Task 2: Create memoized ConfidenceScores component showing decision confidence over time</name>
  <files>src/components/dashboard/ConfidenceScores.tsx</files>
  <action>Create memoized AreaChart (Recharts) showing decision confidence (0-100%) over time. Use same windowing (last 100 points) and memoization pattern as LatencyChart. Add gradient fill (green at 100%, yellow at 50%, red at <30%). Include threshold lines at 50% and 80% for reference. Tooltip shows confidence % and time. Chart displays only last 100 metrics points from store.metrics. Use same memo + useMemo pattern.</action>
  <verify>Import into dashboard, render without errors. React DevTools Profiler: confirm <2 re-renders during 20 mock metric updates. Chart smoothly animates confidence changes without jank.</verify>
  <done>Confidence chart renders with gradient coloring, thresholds visible, memoization working, smooth animation on data updates</done>
</task>

<task type="auto">
  <name>Task 3: Create reusable NumericMetrics display component and integrate all charts into dashboard grid</name>
  <files>src/components/dashboard/NumericMetrics.tsx, src/components/dashboard/AIMetricsDashboard.tsx (update)</files>
  <action>Create simple NumericMetrics component showing current values (not historical): AI State badge, Conversations Active, Avg Latency (last minute avg), Confidence (current %), Context Size tokens, Connection Status. Use numeral library to format large numbers (1234567 → "1.23m", 1000 → "1.0k"). Update AIMetricsDashboard layout to show: top row = numeric metrics, second row = LatencyChart and ConfidenceScores side-by-side, responsive grid. Use Tremor Grid for layout. Ensure charts fit mobile (stack vertically on small screens). All components pull from useMetricsStore hook.</action>
  <verify>npm run dev, visit dashboard, see numeric metrics + charts. Resize browser window: layout responsive on mobile (375px), tablet (768px), desktop (1024px+). Charts visible and updating without lag. All data formatted correctly (numbers use numeral formatting).</verify>
  <done>Full dashboard layout complete with numeric metrics and charts, responsive grid layout, number formatting applied, all data wired from store</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run dev` succeeds, no TypeScript errors
- [ ] Dashboard displays all 3 components: NumericMetrics, LatencyChart, ConfidenceScores
- [ ] Charts update smoothly (no jank with mock metrics)
- [ ] React DevTools shows efficient re-renders (no re-render storms)
- [ ] Memoization working (confirm with Profiler)
- [ ] Responsive layout on desktop (>1024px) and mobile (375px)
- [ ] Number formatting correct (e.g., 1234 → "1.2k")
- [ ] All charts have proper labels, axes, legends
- [ ] No console errors or warnings
</verification>

<success_criteria>

- All three chart/metric components created and integrated
- Memoization implemented correctly (custom comparators prevent unnecessary re-renders)
- Real-time data streaming smoothly from Zustand store
- Responsive layout adapts to mobile/tablet/desktop
- Number formatting applied with numeral library
- Charts show meaningful data (latency, confidence, context)
- Performance verified: no re-render storms visible in DevTools
- Code follows project conventions and RESEARCH.md recommendations

</success_criteria>

<output>
After completion, create `.planning/phases/07-ai-metrics-dashboard/07-03-SUMMARY.md`:

# Phase 7 Plan 03: Charts & Visualization Summary

**Implemented real-time metric charts with Recharts, memoization, and responsive layout.**

## Accomplishments

- Created memoized LatencyChart showing TTFT + TPOT metrics
- Created memoized ConfidenceScores chart with gradient coloring and thresholds
- Built NumericMetrics component for current values (AI State, Conversations, Latency avg, etc.)
- Integrated all components into responsive dashboard grid (Tremor Grid)
- Implemented windowing (last 100 chart points) to prevent memory bloat
- Applied memoization + custom comparators to prevent re-render storms
- Added number formatting with numeral library

## Files Created/Modified

- `src/components/dashboard/LatencyChart.tsx` - Memoized TTFT/TPOT time series chart
- `src/components/dashboard/ConfidenceScores.tsx` - Memoized confidence area chart with gradients
- `src/components/dashboard/NumericMetrics.tsx` - Current metric values display
- `src/components/dashboard/AIMetricsDashboard.tsx` - Updated layout with all components

## Decisions Made

- Chart data windowing at 100 points balances history visibility with performance
- Recharts chosen for simplicity; could upgrade to ECharts if >1000 points needed
- Gradient coloring on confidence chart helps immediate visual assessment
- Memoization with custom comparators more efficient than shallow equality

## Issues Encountered

None

## Next Step

Phase 7 complete. Ready for Phase 8: Real-time HUD & Annotations

</output>
