# Phase 18.1: Internationalization (EN/TR/AR) - Research

**Researched:** 2026-01-27
**Domain:** Next.js App Router i18n with RTL Arabic support
**Confidence:** HIGH

<research_summary>
## Summary

Researched comprehensive i18n implementation for a Next.js 16 App Router application requiring English, Turkish, and Arabic language support. Arabic requires RTL (right-to-left) layout direction, making this a more complex i18n implementation than typical LTR-only setups.

**Key findings:**
1. **next-intl** is the definitive choice for App Router i18n - it's purpose-built for Server Components, has active maintenance, and is used by the Node.js website
2. **Tailwind CSS logical properties** (ms-, me-, ps-, pe-, start, end) handle RTL automatically without code changes - available since Tailwind v3.3.0
3. **Arabic fonts** require specific consideration - IBM Plex Sans Arabic or Noto Sans Arabic are the recommended choices for professional applications
4. **Middleware-based routing** with `[locale]` dynamic segment is the standard pattern for locale-aware URLs

**Primary recommendation:** Use next-intl with middleware routing, Tailwind logical properties for RTL, and IBM Plex Sans Arabic font. Structure translations by feature namespace in JSON files using ICU message format for pluralization.
</research_summary>

<standard_stack>
## Standard Stack

The established libraries/tools for Next.js App Router i18n:

### Core
| Library | Version | Purpose | Why Standard |
|---------|---------|---------|--------------|
| next-intl | ^3.22+ | i18n for App Router | Purpose-built for App Router, Server Components native, used by Node.js website |
| Tailwind CSS | ^3.3.0+ | RTL via logical properties | Built-in RTL support via `ms-`, `me-`, `ps-`, `pe-`, `start`, `end` utilities |

### Supporting
| Library | Version | Purpose | When to Use |
|---------|---------|---------|-------------|
| @next/font or next/font | Built-in | Arabic font loading | Always - for IBM Plex Sans Arabic or Noto Sans Arabic |
| Intl.DisplayNames | Browser API | Display locale names | Language switcher - shows "English" in current language |

### Alternatives Considered
| Instead of | Could Use | Tradeoff |
|------------|-----------|----------|
| next-intl | react-i18next + next-i18n-router | More config, not purpose-built for App Router, requires additional setup |
| next-intl | Intlayer | Newer, less battle-tested, but has visual editor |
| Tailwind logical properties | tailwindcss-rtl plugin | Plugin adds overhead; logical properties are built-in since v3.3 |

**Installation:**
```bash
npm install next-intl
```

No additional i18n packages needed - next-intl handles everything.
</standard_stack>

<architecture_patterns>
## Architecture Patterns

### Recommended Project Structure
```
src/
├── i18n/
│   ├── routing.ts           # defineRouting config (locales, defaultLocale)
│   ├── request.ts           # getRequestConfig for server components
│   └── navigation.ts        # createNavigation exports (Link, useRouter, etc.)
├── messages/
│   ├── en.json              # English translations
│   ├── tr.json              # Turkish translations
│   └── ar.json              # Arabic translations
├── app/
│   ├── [locale]/            # All routes under locale segment
│   │   ├── layout.tsx       # Sets lang/dir, provides NextIntlClientProvider
│   │   ├── page.tsx         # Home page
│   │   └── (main)/          # Main app routes
│   │       ├── dashboard/
│   │       ├── inbox/
│   │       └── ...
├── middleware.ts            # Locale detection and routing
└── components/
    └── LanguageSwitcher.tsx # Language dropdown component
```

### Pattern 1: Routing Configuration
**What:** Central routing config shared between middleware and navigation
**When to use:** Always - this is the foundation
**Example:**
```typescript
// src/i18n/routing.ts
import { defineRouting } from 'next-intl/routing';

export const routing = defineRouting({
  locales: ['en', 'tr', 'ar'],
  defaultLocale: 'en',
  localePrefix: 'as-needed' // Only prefix non-default locales
});

// src/i18n/navigation.ts
import { createNavigation } from 'next-intl/navigation';
import { routing } from './routing';

export const { Link, redirect, usePathname, useRouter, getPathname } =
  createNavigation(routing);
```

### Pattern 2: Middleware Setup
**What:** Handles locale detection, routing, and cookie management
**When to use:** Always - required for locale-based routing
**Example:**
```typescript
// src/middleware.ts
import createMiddleware from 'next-intl/middleware';
import { routing } from './i18n/routing';

export default createMiddleware(routing);

export const config = {
  matcher: [
    // Match all pathnames except for
    // - API routes
    // - Static files
    // - _next internals
    '/((?!api|_next|_vercel|.*\\..*).*)'
  ]
};
```

### Pattern 3: Locale Layout with RTL
**What:** Root layout that sets language direction and provides translations
**When to use:** Always - foundation for all pages
**Example:**
```typescript
// src/app/[locale]/layout.tsx
import { NextIntlClientProvider } from 'next-intl';
import { getMessages, setRequestLocale } from 'next-intl/server';
import { routing } from '@/i18n/routing';
import { notFound } from 'next/navigation';

export function generateStaticParams() {
  return routing.locales.map((locale) => ({ locale }));
}

export default async function LocaleLayout({
  children,
  params: { locale }
}: {
  children: React.ReactNode;
  params: { locale: string };
}) {
  // Validate locale
  if (!routing.locales.includes(locale as any)) {
    notFound();
  }

  // Enable static rendering
  setRequestLocale(locale);

  // Get messages for client components
  const messages = await getMessages();

  // Determine direction
  const dir = locale === 'ar' ? 'rtl' : 'ltr';

  return (
    <html lang={locale} dir={dir} suppressHydrationWarning>
      <body>
        <NextIntlClientProvider messages={messages}>
          {children}
        </NextIntlClientProvider>
      </body>
    </html>
  );
}
```

### Pattern 4: Using Translations
**What:** Accessing translations in Server and Client components
**When to use:** Everywhere text is displayed
**Example:**
```typescript
// Server Component
import { useTranslations } from 'next-intl';

export default function Dashboard() {
  const t = useTranslations('Dashboard');
  return <h1>{t('title')}</h1>;
}

// Client Component
'use client';
import { useTranslations } from 'next-intl';

export default function Button() {
  const t = useTranslations('Common');
  return <button>{t('submit')}</button>;
}
```

### Pattern 5: Language Switcher
**What:** Dropdown to switch between languages
**When to use:** Header or settings
**Example:**
```typescript
'use client';
import { useLocale } from 'next-intl';
import { useRouter, usePathname } from '@/i18n/navigation';
import { routing } from '@/i18n/routing';

const localeNames: Record<string, string> = {
  en: 'English',
  tr: 'Türkçe',
  ar: 'العربية'
};

export function LanguageSwitcher() {
  const locale = useLocale();
  const router = useRouter();
  const pathname = usePathname();

  function onChange(newLocale: string) {
    router.replace(pathname, { locale: newLocale });
  }

  return (
    <select value={locale} onChange={(e) => onChange(e.target.value)}>
      {routing.locales.map((loc) => (
        <option key={loc} value={loc}>
          {localeNames[loc]}
        </option>
      ))}
    </select>
  );
}
```

### Anti-Patterns to Avoid
- **Hardcoding text in JSX:** All user-visible text must come from translation files
- **Using left/right in CSS:** Use logical properties (start/end, ms-/me-, ps-/pe-) for RTL compatibility
- **Forgetting setRequestLocale:** Required in every page and layout for static rendering
- **Mixing navigation imports:** Use navigation from `@/i18n/navigation`, not `next/navigation`
</architecture_patterns>

<dont_hand_roll>
## Don't Hand-Roll

Problems that look simple but have existing solutions:

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| Locale routing | Custom middleware logic | next-intl/middleware | Handles Accept-Language, cookies, redirects, prefix logic |
| RTL layout flipping | Manual CSS overrides | Tailwind logical properties | `ms-4` automatically becomes `margin-right` in RTL |
| Pluralization | if/else for counts | ICU message format | Languages have 1-6 plural forms; ICU handles all |
| Date/number formatting | moment.js, custom formatters | next-intl formatters | Uses Intl APIs, locale-aware, no bundle bloat |
| Language detection | navigator.language checks | next-intl middleware | Handles Accept-Language header, cookies, URL prefixes |
| Translation loading | Dynamic imports, fetch calls | next-intl getMessages | Server-side, cached, type-safe |

**Key insight:** i18n has decades of solved problems (ICU, CLDR). next-intl wraps these standards. Custom solutions will miss edge cases like Arabic plural forms (which have 6 categories) or Turkish dotless-i sorting.
</dont_hand_roll>

<common_pitfalls>
## Common Pitfalls

### Pitfall 1: Hydration Mismatch with Dates/Times
**What goes wrong:** Server renders "January 27" but client shows "27 كانون الثاني" causing hydration error
**Why it happens:** Server and client have different locale settings during SSR
**How to avoid:** Always use `useFormatter` from next-intl and ensure locale is set correctly via `setRequestLocale`
**Warning signs:** React hydration warnings in console, flickering dates

### Pitfall 2: Missing setRequestLocale Calls
**What goes wrong:** "Unable to find next-intl locale" error or dynamic rendering forced
**Why it happens:** next-intl needs locale set in every page/layout for static rendering
**How to avoid:** Add `setRequestLocale(locale)` at the top of every page.tsx and layout.tsx
**Warning signs:** Build warnings about dynamic rendering, locale errors

### Pitfall 3: Navigation Import Confusion
**What goes wrong:** Language switcher doesn't preserve current page, or locale not in URL
**Why it happens:** Using `next/navigation` instead of `@/i18n/navigation`
**How to avoid:** Always import Link, useRouter, usePathname from `@/i18n/navigation`
**Warning signs:** URLs missing locale prefix, router.push not changing language

### Pitfall 4: RTL Layout Breaking
**What goes wrong:** Icons, arrows, progress bars point wrong direction in Arabic
**Why it happens:** Using `ml-4`, `mr-2`, `left`, `right` instead of logical properties
**How to avoid:** Audit all CSS for `left/right/ml/mr/pl/pr` and replace with `start/end/ms/me/ps/pe`
**Warning signs:** UI looks mirrored incorrectly, arrows pointing backward

### Pitfall 5: Arabic Font Not Loading
**What goes wrong:** Arabic text shows as boxes or falls back to system font
**Why it happens:** Inter font only has Latin subset, no Arabic glyphs
**How to avoid:** Add IBM Plex Sans Arabic with `subsets: ['arabic']` or use Noto Sans Arabic
**Warning signs:** Arabic text looks different from design, missing characters

### Pitfall 6: Locale Stacking in URLs
**What goes wrong:** URL becomes `/en/ar/dashboard` instead of `/ar/dashboard`
**Why it happens:** usePathname returning pathname with locale prefix
**How to avoid:** Use Link and router from `@/i18n/navigation` which handle this correctly
**Warning signs:** Double locale prefixes in URLs

### Pitfall 7: Turbopack Compatibility (Next.js 15+)
**What goes wrong:** "Couldn't find next-intl config file" error
**Why it happens:** Turbopack needs explicit configuration
**How to avoid:** Add `turbopack: {}` to next.config.ts and configure experimental.turbo if needed
**Warning signs:** Error only appears with `--turbo` flag
</common_pitfalls>

<code_examples>
## Code Examples

Verified patterns from official sources:

### Translation File Structure (messages/en.json)
```json
{
  "Common": {
    "appName": "AI BY SEA",
    "loading": "Loading...",
    "save": "Save",
    "cancel": "Cancel",
    "delete": "Delete",
    "edit": "Edit",
    "search": "Search",
    "noResults": "No results found"
  },
  "Navigation": {
    "dashboard": "Dashboard",
    "inbox": "Inbox",
    "agents": "AI Agents",
    "contacts": "Contacts",
    "voiceAgents": "Voice Agents",
    "callLogs": "Call Logs",
    "phoneNumbers": "Phone Numbers",
    "upload": "Upload",
    "processing": "Processing",
    "data": "Data",
    "settings": "Settings"
  },
  "Dashboard": {
    "title": "Dashboard",
    "conversationalAI": "Conversational AI",
    "voiceAgents": "Voice Agents",
    "documentIntelligence": "Document Intelligence",
    "conversations": "{count, plural, =0 {No conversations} one {1 conversation} other {{count} conversations}} today",
    "calls": "{count, plural, =0 {No calls} one {1 call} other {{count} calls}} today",
    "documents": "{count, plural, =0 {No documents} one {1 document} other {{count} documents}} processed",
    "viewInbox": "View Inbox",
    "manageVoice": "Manage Voice",
    "processDocuments": "Process Documents",
    "recentActivity": "Recent Activity",
    "activeAgents": "Active Agents",
    "topChannels": "Top Channels"
  }
}
```

### Arabic Translation (messages/ar.json)
```json
{
  "Common": {
    "appName": "AI BY SEA",
    "loading": "جاري التحميل...",
    "save": "حفظ",
    "cancel": "إلغاء",
    "delete": "حذف",
    "edit": "تعديل",
    "search": "بحث",
    "noResults": "لم يتم العثور على نتائج"
  },
  "Navigation": {
    "dashboard": "لوحة التحكم",
    "inbox": "صندوق الوارد",
    "agents": "وكلاء الذكاء الاصطناعي",
    "contacts": "جهات الاتصال",
    "voiceAgents": "وكلاء الصوت",
    "callLogs": "سجلات المكالمات",
    "phoneNumbers": "أرقام الهواتف",
    "upload": "رفع",
    "processing": "المعالجة",
    "data": "البيانات",
    "settings": "الإعدادات"
  },
  "Dashboard": {
    "title": "لوحة التحكم",
    "conversationalAI": "الذكاء الاصطناعي المحادثاتي",
    "voiceAgents": "وكلاء الصوت",
    "documentIntelligence": "ذكاء المستندات",
    "conversations": "{count, plural, =0 {لا توجد محادثات} one {محادثة واحدة} two {محادثتان} few {{count} محادثات} many {{count} محادثة} other {{count} محادثة}} اليوم",
    "calls": "{count, plural, =0 {لا توجد مكالمات} one {مكالمة واحدة} two {مكالمتان} few {{count} مكالمات} many {{count} مكالمة} other {{count} مكالمة}} اليوم",
    "documents": "{count, plural, =0 {لا توجد مستندات} one {مستند واحد} two {مستندان} few {{count} مستندات} many {{count} مستند} other {{count} مستند}} تمت معالجتها",
    "viewInbox": "عرض صندوق الوارد",
    "manageVoice": "إدارة الصوت",
    "processDocuments": "معالجة المستندات",
    "recentActivity": "النشاط الأخير",
    "activeAgents": "الوكلاء النشطون",
    "topChannels": "أهم القنوات"
  }
}
```

### Turkish Translation (messages/tr.json)
```json
{
  "Common": {
    "appName": "AI BY SEA",
    "loading": "Yükleniyor...",
    "save": "Kaydet",
    "cancel": "İptal",
    "delete": "Sil",
    "edit": "Düzenle",
    "search": "Ara",
    "noResults": "Sonuç bulunamadı"
  },
  "Navigation": {
    "dashboard": "Gösterge Paneli",
    "inbox": "Gelen Kutusu",
    "agents": "AI Ajanları",
    "contacts": "Kişiler",
    "voiceAgents": "Sesli Ajanlar",
    "callLogs": "Arama Kayıtları",
    "phoneNumbers": "Telefon Numaraları",
    "upload": "Yükle",
    "processing": "İşleme",
    "data": "Veri",
    "settings": "Ayarlar"
  },
  "Dashboard": {
    "title": "Gösterge Paneli",
    "conversationalAI": "Konuşma Yapay Zekası",
    "voiceAgents": "Sesli Ajanlar",
    "documentIntelligence": "Belge Zekası",
    "conversations": "{count, plural, =0 {Görüşme yok} one {1 görüşme} other {{count} görüşme}} bugün",
    "calls": "{count, plural, =0 {Arama yok} one {1 arama} other {{count} arama}} bugün",
    "documents": "{count, plural, =0 {Belge yok} one {1 belge} other {{count} belge}} işlendi",
    "viewInbox": "Gelen Kutusunu Görüntüle",
    "manageVoice": "Sesi Yönet",
    "processDocuments": "Belgeleri İşle",
    "recentActivity": "Son Etkinlik",
    "activeAgents": "Aktif Ajanlar",
    "topChannels": "En İyi Kanallar"
  }
}
```

### next.config.ts Configuration
```typescript
// Source: next-intl docs
import type { NextConfig } from 'next';
import createNextIntlPlugin from 'next-intl/plugin';

const withNextIntl = createNextIntlPlugin('./src/i18n/request.ts');

const nextConfig: NextConfig = {
  // Required for Turbopack compatibility
  experimental: {
    turbo: {}
  }
};

export default withNextIntl(nextConfig);
```

### Request Configuration (src/i18n/request.ts)
```typescript
// Source: next-intl docs
import { getRequestConfig } from 'next-intl/server';
import { routing } from './routing';

export default getRequestConfig(async ({ requestLocale }) => {
  // This typically corresponds to the `[locale]` segment
  let locale = await requestLocale;

  // Ensure that a valid locale is used
  if (!locale || !routing.locales.includes(locale as any)) {
    locale = routing.defaultLocale;
  }

  return {
    locale,
    messages: (await import(`../messages/${locale}.json`)).default
  };
});
```

### RTL-Safe Tailwind Classes
```typescript
// BEFORE (breaks in RTL)
<div className="ml-4 pl-2 text-left border-l-2">

// AFTER (works in both LTR and RTL)
<div className="ms-4 ps-2 text-start border-s-2">

// Logical property mappings:
// ml-* → ms-*  (margin-inline-start)
// mr-* → me-*  (margin-inline-end)
// pl-* → ps-*  (padding-inline-start)
// pr-* → pe-*  (padding-inline-end)
// left-* → start-*
// right-* → end-*
// text-left → text-start
// text-right → text-end
// border-l-* → border-s-*
// border-r-* → border-e-*
// rounded-l-* → rounded-s-*
// rounded-r-* → rounded-e-*
```

### Font Configuration with Arabic Support
```typescript
// src/app/[locale]/layout.tsx
import { Inter } from 'next/font/google';
import { IBM_Plex_Sans_Arabic } from 'next/font/google';

const inter = Inter({
  variable: '--font-inter',
  subsets: ['latin'],
  display: 'swap',
});

const ibmPlexArabic = IBM_Plex_Sans_Arabic({
  variable: '--font-arabic',
  subsets: ['arabic'],
  weight: ['400', '500', '600', '700'],
  display: 'swap',
});

// In layout:
<html
  lang={locale}
  dir={locale === 'ar' ? 'rtl' : 'ltr'}
  className={`${inter.variable} ${ibmPlexArabic.variable}`}
>

// In globals.css or Tailwind config:
// font-family: var(--font-inter), var(--font-arabic), sans-serif;
```
</code_examples>

<sota_updates>
## State of the Art (2025-2026)

What's changed recently:

| Old Approach | Current Approach | When Changed | Impact |
|--------------|------------------|--------------|--------|
| next-i18next | next-intl | 2023+ | next-i18next incompatible with App Router; next-intl is the standard |
| Pages Router i18n | App Router `[locale]` segment | Next.js 13+ | Built-in i18n removed, use next-intl middleware |
| Manual RTL CSS | Tailwind logical properties | Tailwind v3.3 (2023) | No more manual `rtl:` overrides needed |
| middleware.ts | proxy.ts | Next.js 16 | File renamed but functionality same |
| Font subsetting manual | next/font auto-subsetting | Next.js 13+ | Automatic optimal font loading |

**New tools/patterns to consider:**
- **next-intl 3.22+:** Latest version with improved static rendering support
- **Tailwind v4:** Moved PostCSS to separate package - ensure `@tailwindcss/postcss` is used

**Deprecated/outdated:**
- **next-i18next:** Not compatible with App Router - do not use
- **Manual locale detection:** Use next-intl middleware instead
- **react-intl standalone:** Use next-intl which integrates ICU formatting
</sota_updates>

<translation_scope>
## Translation Scope Analysis

Based on codebase analysis, the following areas require translation:

### High Priority (User-Facing)
1. **Navigation** - Sidebar, BottomNav, MobileNav items
2. **Page Titles** - TopBar titles across all pages
3. **Dashboard** - Service cards, stats, activity feed
4. **Forms** - Input labels, placeholders, validation messages
5. **Buttons** - All action buttons (Save, Cancel, Delete, etc.)
6. **Status Indicators** - Active, Pending, Completed, etc.

### Medium Priority (Secondary UI)
7. **Empty States** - "No results", "No conversations", etc.
8. **Tooltips** - Hover information
9. **Notifications** - Success/error messages
10. **Modals** - Dialog titles and content

### Low Priority (Static/Less Visible)
11. **Meta Information** - Page titles in browser tab
12. **Alt Text** - Image descriptions
13. **Aria Labels** - Accessibility labels

### Estimated Translation Count
- **English strings:** ~200-300 unique strings
- **Turkish translations:** Same count
- **Arabic translations:** Same count + RTL considerations

### Files Requiring Changes
1. `src/app/layout.tsx` → Move to `src/app/[locale]/layout.tsx`
2. `src/app/(main)/layout.tsx` → Update for locale
3. All page files → Add translations
4. All component files → Replace hardcoded text
5. `src/components/layout/Sidebar.tsx` → Navigation translations
6. `src/components/layout/BottomNav.tsx` → Navigation translations
7. `src/components/layout/TopBar.tsx` → Title translations
8. `next.config.ts` → Add next-intl plugin
</translation_scope>

<open_questions>
## Open Questions

All questions have been resolved through research:

1. **Library choice** - RESOLVED: next-intl is the definitive choice for App Router
2. **RTL approach** - RESOLVED: Tailwind logical properties handle this automatically
3. **Font selection** - RESOLVED: IBM Plex Sans Arabic recommended for professional look
4. **Static vs Dynamic rendering** - RESOLVED: Use setRequestLocale for static rendering
5. **URL structure** - RESOLVED: Use `localePrefix: 'as-needed'` (only prefix non-default)
</open_questions>

<sources>
## Sources

### Primary (HIGH confidence)
- [next-intl official documentation](https://next-intl.dev/docs/getting-started/app-router) - Complete setup guide
- [next-intl routing setup](https://next-intl.dev/docs/routing/setup) - Middleware and navigation
- [Tailwind CSS RTL support](https://flowbite.com/docs/customize/rtl/) - Logical properties
- [Next.js i18n guide](https://nextjs.org/docs/pages/guides/internationalization) - Official patterns

### Secondary (MEDIUM confidence)
- [next-intl Guide 2025](https://www.buildwithmatija.com/blog/nextjs-internationalization-guide-next-intl-2025) - Complete setup guide verified with docs
- [IBM Plex Sans Arabic](https://fonts.google.com/specimen/IBM+Plex+Sans+Arabic) - Font information
- [Medium: Why I Chose next-intl](https://medium.com/@isurusasanga1999/why-i-chose-next-intl-for-internationalization-in-my-next-js-66c9e49dd486) - Comparison article

### Tertiary (Verified)
- [GitHub: next-intl issues](https://github.com/amannn/next-intl/issues) - Known issues and solutions
- [tailwindcss-rtl npm](https://www.npmjs.com/package/tailwindcss-rtl) - Plugin documentation
</sources>

<metadata>
## Metadata

**Research scope:**
- Core technology: next-intl for Next.js App Router
- Ecosystem: Tailwind CSS RTL, Google Fonts Arabic
- Patterns: Middleware routing, locale layouts, translation namespaces
- Pitfalls: Hydration, setRequestLocale, navigation imports, RTL CSS

**Confidence breakdown:**
- Standard stack: HIGH - next-intl is the clear winner, widely adopted
- Architecture: HIGH - Documented in official next-intl guides
- Pitfalls: HIGH - Documented issues with solutions
- Code examples: HIGH - From official documentation

**Research date:** 2026-01-27
**Valid until:** 2026-02-27 (30 days - next-intl ecosystem stable)
</metadata>

---

*Phase: 18.1-internationalization*
*Research completed: 2026-01-27*
*Ready for planning: yes*
