---
phase: 16-nav-layer
plan: 02
type: execute
---

<objective>
Refine mobile drawer for secondary navigation and integrate bottom nav with layout system.

Purpose: Complete the mobile navigation overhaul by restructuring drawer as "More" overflow menu, adding swipe-to-close, and ensuring layout properly accounts for bottom nav.
Output: Refined drawer with secondary items, swipe gesture, layout with bottom padding, keyboard-aware bottom nav.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-nav-layer/RESEARCH.md
@.planning/phases/02-nav-layer/16-01-SUMMARY.md

**Key files:**
@src/stores/navigation.ts (created in 16-01)
@src/components/layout/BottomNav.tsx (created in 16-01)
@src/components/layout/MobileNav.tsx (to be modified)
@src/app/(main)/layout.tsx (to be modified)

**Established patterns:**
- Navigation store with isDrawerOpen, openDrawer, closeDrawer
- 44px touch targets, 56px bottom nav height
- Framer Motion available for animations

**From RESEARCH.md - Drawer Structure:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [X]  More                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”€â”€â”€ CONVERSATIONAL â”€â”€â”€      â”‚
â”‚ ğŸ‘¥ Contacts                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”€â”€â”€ VOICE â”€â”€â”€               â”‚
â”‚ ğŸ“ Call Logs                â”‚
â”‚ ğŸ“± Phone Numbers            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”€â”€â”€ DOCUMENTS â”€â”€â”€           â”‚
â”‚ ğŸ“„ Upload                   â”‚
â”‚ âš™ï¸ Processing               â”‚
â”‚ ğŸ“Š Data                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âš™ï¸ Settings                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Animation specs:**
- Drawer enter: 300ms cubic-bezier(0.32, 0.72, 0, 1)
- Drawer exit: 250ms (slightly faster)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Restructure MobileNav drawer as secondary menu</name>
  <files>src/components/layout/MobileNav.tsx</files>
  <action>
Refactor MobileNav to use navigation store and show only secondary items:

1. Replace useState(isOpen) with useNavigationStore:
   - Import { useNavigationStore } from '@/stores/navigation'
   - const { isDrawerOpen, openDrawer, closeDrawer } = useNavigationStore()

2. Remove items now in bottom nav from drawer:
   - Remove Dashboard, Inbox, Agents, Voice Agents from drawer content
   - Keep: Contacts (Conversational), Call Logs, Phone Numbers (Voice), Upload, Processing, Data (Documents), Settings

3. Update drawer header:
   - Change title from "AI BY SEA" to "More"
   - Keep close button

4. Restructure navigation data:
```typescript
const drawerNavigation = {
  sections: [
    {
      name: 'Conversational',
      items: [{ name: 'Contacts', href: '/contacts', icon: Users }],
    },
    {
      name: 'Voice',
      items: [
        { name: 'Call Logs', href: '/call-logs', icon: FileText },
        { name: 'Phone Numbers', href: '/phone-numbers', icon: Phone },
      ],
    },
    {
      name: 'Documents',
      items: [
        { name: 'Upload', href: '/documents', icon: FileText },
        { name: 'Processing', href: '/processing', icon: Zap },
        { name: 'Data', href: '/data', icon: Users },
      ],
    },
  ],
  bottom: [{ name: 'Settings', href: '/settings', icon: Settings }],
};
```

5. Remove module accordion pattern - use flat grouped list with section headers

6. Add swipe-to-close gesture using Framer Motion:
   - Wrap drawer in motion.div with drag="x" dragConstraints
   - onDragEnd: if deltaX < -100, close drawer
   - Keep click-outside-to-close behavior

7. Update header button to use openDrawer from store (hamburger menu triggers drawer)

AVOID: Don't change mobile header bar appearance. Don't add bottom nav code here - it's separate component.
  </action>
  <verify>
npm run build passes
Drawer opens when hamburger clicked
Drawer shows only secondary items (Contacts, Call Logs, Phone Numbers, Documents items, Settings)
Drawer closes on swipe left or click outside
  </verify>
  <done>
- Drawer uses navigation store state
- Only secondary items in drawer (not Dashboard/Inbox/Agents/Voice)
- Swipe-to-close gesture works
- Section headers visible (Conversational, Voice, Documents)
  </done>
</task>

<task type="auto">
  <name>Task 2: Layout integration with bottom nav padding and keyboard detection</name>
  <files>src/app/(main)/layout.tsx, src/app/globals.css</files>
  <action>
1. Update layout.tsx:
   - Add bottom padding on mobile to account for bottom nav (pb-[calc(56px+env(safe-area-inset-bottom))])
   - Only apply on mobile: pb-[calc(56px+env(safe-area-inset-bottom))] lg:pb-0
   - Ensure content doesn't get hidden behind bottom nav

2. Add keyboard detection to hide bottom nav:
   - Create useKeyboardVisible hook (or inline in BottomNav):
   ```typescript
   useEffect(() => {
     const handleResize = () => {
       // On iOS/Android, window height shrinks when keyboard opens
       const isKeyboardVisible = window.visualViewport
         ? window.visualViewport.height < window.innerHeight * 0.8
         : false;
       if (isKeyboardVisible) hideBottomNav();
       else showBottomNav();
     };
     window.visualViewport?.addEventListener('resize', handleResize);
     return () => window.visualViewport?.removeEventListener('resize', handleResize);
   }, []);
   ```
   - Use bottomNavVisible from navigation store to conditionally render BottomNav

3. Update BottomNav to respect bottomNavVisible:
   - const { bottomNavVisible } = useNavigationStore()
   - if (!bottomNavVisible) return null

4. Add CSS custom property for bottom nav height in globals.css:
   ```css
   :root {
     --nav-height-bottom: 56px;
   }
   ```

5. Ensure page transitions don't flash (content already has overflow-auto from 15-02)

AVOID: Don't add complex animation state for keyboard. Simple show/hide is sufficient.
  </action>
  <verify>
npm run build passes
Mobile content has bottom padding (content not hidden behind nav)
Bottom nav hides when keyboard opens (test in mobile DevTools emulation)
Bottom nav returns when keyboard closes
  </verify>
  <done>
- Layout has responsive bottom padding for nav bar
- Bottom nav hides during keyboard input
- CSS custom property defined for nav height
- No content hidden behind bottom nav
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete mobile navigation system with bottom nav + refined drawer</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Open browser DevTools, set viewport to mobile (375px)

    **Bottom Navigation:**
    3. Verify bottom nav has 5 items: Dashboard, Inbox, Agents, Voice, More
    4. Tap each of first 4 items - verify navigation works and highlights
    5. Verify active route clearly highlighted (gradient background)

    **More Drawer:**
    6. Tap "More" - verify drawer slides in from left
    7. Verify drawer shows: Contacts, Call Logs, Phone Numbers, Documents items, Settings
    8. Verify drawer does NOT show: Dashboard, Inbox, Agents, Voice Agents
    9. Tap "Contacts" - verify navigation and drawer closes
    10. Open drawer again, swipe left - verify drawer closes
    11. Open drawer, tap outside - verify drawer closes

    **Layout:**
    12. Scroll down on any long page - verify content scrolls above bottom nav
    13. Tap into message compose (if available) - verify bottom nav hides
    14. Dismiss keyboard - verify bottom nav returns

    **Desktop:**
    15. Resize to desktop (>1024px) - verify bottom nav gone, sidebar visible

    **Edge Cases:**
    16. Navigate /dashboard â†’ /inbox â†’ back button - verify correct behavior
    17. Open drawer, rotate phone (if testing on device) - verify drawer stays open
  </how-to-verify>
  <resume-signal>Type "approved" if navigation works correctly, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Drawer uses navigation store (not local useState)
- [ ] Drawer shows only secondary items
- [ ] Swipe-to-close gesture works
- [ ] Layout has bottom padding for nav bar
- [ ] Bottom nav hides during keyboard visibility
- [ ] No content hidden behind bottom nav
- [ ] All navigation routes work correctly
</verification>

<success_criteria>

- MobileNav drawer restructured for secondary items
- Swipe-to-close gesture implemented
- Layout properly padded for bottom nav
- Keyboard detection hides bottom nav
- Complete mobile navigation flow works
- Phase 16 complete
</success_criteria>

<output>
After completion, create `.planning/phases/02-nav-layer/16-02-SUMMARY.md` using frontmatter template.

Final summary should note:
- Phase 16: Navigation & Mobile UX complete
- Bottom nav with 4+More pattern implemented
- Drawer restructured for secondary navigation
- Layout integrated with responsive padding
- Ready for Phase 17: Core Pages Responsive
</output>
