---
phase: 16-nav-layer
plan: 01
type: execute
---

<objective>
Create navigation state management with Zustand and bottom navigation component for mobile UX.

Purpose: Replace hamburger-only navigation with visible bottom nav bar (4+More pattern) that provides one-tap access to primary features - critical for mobile engagement.
Output: Navigation store, BottomNav component, visible on mobile with working tab switching.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-nav-layer/RESEARCH.md
@.planning/phases/01-mobile-sys/15-01-SUMMARY.md
@.planning/phases/01-mobile-sys/15-02-SUMMARY.md

**Key files:**
@src/stores/metricsStore.ts (Zustand pattern reference)
@src/components/layout/MobileNav.tsx (current navigation)
@src/app/(main)/layout.tsx (layout integration point)

**Tech stack available:**
- Zustand ^4.5.7 (installed)
- Framer Motion ^11.18.2 (installed)
- Lucide React icons
- Custom 7-breakpoint system (xs through 2xl)
- CSS custom properties for responsive values

**Established patterns:**
- Zustand store pattern from metricsStore.ts
- 44px minimum touch targets (WCAG 2.5.8)
- Mobile-first breakpoints (xs/sm/md for phones, tablet for iPad, lg+ for desktop)

**From RESEARCH.md:**
- Bottom nav: 4 primary items (Dashboard, Inbox, Agents, Voice) + More overflow
- 56px height + env(safe-area-inset-bottom) for notch phones
- Active state indicators with gradient (from-accent to-primary)
- Navigation store: isDrawerOpen, activeRoute, previousRoute, scrollPositions, bottomNavVisible
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Zustand navigation store</name>
  <files>src/stores/navigation.ts</files>
  <action>
Create navigation store following existing metricsStore.ts pattern:

```typescript
interface NavigationState {
  isDrawerOpen: boolean;
  activeRoute: string;
  previousRoute: string | null;
  scrollPositions: Map<string, number>;
  bottomNavVisible: boolean;
}

interface NavigationActions {
  openDrawer: () => void;
  closeDrawer: () => void;
  toggleDrawer: () => void;
  setActiveRoute: (route: string) => void;
  saveScrollPosition: (route: string, position: number) => void;
  restoreScrollPosition: (route: string) => number;
  hideBottomNav: () => void;
  showBottomNav: () => void;
}
```

Use `create` from zustand. Store scroll positions as Record<string, number> (JSON-serializable). Default bottomNavVisible to true.

AVOID: Complex middleware or persistence - keep it simple like metricsStore.
  </action>
  <verify>TypeScript compilation passes (no type errors in file)</verify>
  <done>Navigation store exports useNavigationStore hook with all state and actions</done>
</task>

<task type="auto">
  <name>Task 2: Create BottomNav component with 4+More pattern</name>
  <files>src/components/layout/BottomNav.tsx, src/components/layout/BottomNavItem.tsx</files>
  <action>
Create BottomNav.tsx:
- Fixed to bottom, 56px height + env(safe-area-inset-bottom)
- Show only on mobile (lg:hidden)
- 5 items: Dashboard (/dashboard), Inbox (/inbox), Agents (/agents), Voice (/voice-agents), More (opens drawer)
- Use Lucide icons: LayoutDashboard, Inbox, Zap, Phone, MoreHorizontal
- Active state: gradient background (bg-gradient-to-r from-accent to-primary), white text
- Inactive state: text-muted, gray icon
- Each item: flex-1, flex-col, items-center, justify-center, min-h-[56px], min-w-[64px] (touch target)
- Border-top: 1px solid border color
- z-index: 50 (same as mobile header)
- Background: white in light mode, slate-900 in dark mode

Create BottomNavItem.tsx:
- Props: href, icon, label, isActive, onClick (optional, for More button)
- Use Next.js Link for navigation items
- Button for More (triggers drawer open via navigation store)
- Icon: 24x24, label: text-[10px] font-semibold, gap-0.5

Wire up:
- Use usePathname to detect active route
- Use useNavigationStore for drawer toggle
- Add to layout.tsx: import and render BottomNav after MobileNav

AVOID: Don't modify MobileNav yet - that's Plan 02. Just add BottomNav as new component.
  </action>
  <verify>
npm run build passes
Bottom nav visible on mobile viewport (< 1024px)
Tapping Dashboard/Inbox/Agents/Voice navigates to correct route
More button doesn't navigate (console.log for now, drawer integration in Plan 02)
  </verify>
  <done>
- BottomNav renders on mobile with 5 items
- Active state highlights current route
- Touch targets meet 44px minimum (56px height achieved)
- Navigation works for 4 primary items
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Bottom navigation bar with 4+More pattern for mobile</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Open browser DevTools, set viewport to mobile (375px wide)
    3. Verify bottom nav bar appears with 5 items: Dashboard, Inbox, Agents, Voice, More
    4. Tap Dashboard - verify it navigates to /dashboard and highlights
    5. Tap Inbox - verify it navigates to /inbox and highlights
    6. Tap Agents - verify it navigates to /agents and highlights
    7. Tap Voice - verify it navigates to /voice-agents and highlights
    8. Verify icons are centered with labels below
    9. Verify touch targets feel comfortable (not cramped)
    10. Resize to desktop (>1024px) - verify bottom nav disappears
  </how-to-verify>
  <resume-signal>Type "approved" to continue to Plan 02, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Navigation store exports useNavigationStore hook
- [ ] BottomNav renders on mobile viewports
- [ ] 4 primary nav items navigate correctly
- [ ] Active state clearly visible (gradient highlight)
- [ ] Touch targets comfortable (56px height)
- [ ] Safe area inset applied for notch phones
- [ ] Desktop view hides bottom nav
</verification>

<success_criteria>

- Navigation store created with Zustand pattern
- BottomNav component renders on mobile
- 4 primary items navigate to correct routes
- Active state visually distinct
- Layout updated to include BottomNav
- No TypeScript or build errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-nav-layer/16-01-SUMMARY.md` using frontmatter template from 15-02-SUMMARY.md
</output>
