---
phase: 19-performance-polish
plan: 03
type: execute
---

<objective>
Optimize images and implement skeleton loading states across all pages for better perceived performance and Core Web Vitals.

Purpose: Reduce image payload, prevent layout shift (CLS), and provide visual feedback during async loading.
Output: WebP images, blur placeholders, skeleton screens for all major UI sections.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/19-performance-polish/RESEARCH.md
@.planning/phases/19-performance-polish/19-01-SUMMARY.md
@.planning/phases/19-performance-polish/19-02-SUMMARY.md
@src/components/layout/Sidebar.tsx
@src/components/layout/MobileNav.tsx

**From prior plans:**
- Bundle analyzer configured
- Code splitting implemented (~400KB saved)

**Current images:**
- Logo: `public/images/ChatGPT Image Jan 16, 2026, 11_30_10 PM.png` (PNG, needs optimization)
- Avatar: `public/images/rashed.jpeg` (JPEG, check size)

**Pattern from RESEARCH.md:**
- Convert PNG to WebP (smaller file size, better compression)
- Add blur placeholders to prevent layout shift
- Remove `priority` from non-LCP images (logo in sidebar is not critical)
- Implement skeleton components for async data loading
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert logo to WebP and optimize image loading</name>
  <files>public/images/logo.webp, src/components/layout/Sidebar.tsx, src/components/layout/MobileNav.tsx</files>
  <action>
Convert logo PNG to WebP format for better compression:

1. Use Next.js built-in image optimization or external tool:
```bash
# If sharp is available (check node_modules):
# Create optimized WebP version programmatically

# Or manual conversion with online tool:
# - Open public/images/ChatGPT Image Jan 16, 2026, 11_30_10 PM.png
# - Convert to WebP at 80% quality
# - Save as public/images/logo.webp
# - Verify file size is significantly smaller
```

2. Update Sidebar.tsx logo:
```tsx
// Before:
<Image
  src="/images/ChatGPT Image Jan 16, 2026, 11_30_10 PM.png"
  alt="AI BY SEA"
  fill
  className="object-contain"
  priority  // REMOVE - sidebar logo is not LCP
/>

// After:
<Image
  src="/images/logo.webp"
  alt="AI BY SEA"
  fill
  className="object-contain"
  // No priority - lazy load
  // No placeholder needed - sidebar is above fold but not LCP
/>
```

3. Update MobileNav.tsx if logo is also used there (check file)

4. Keep original filename for git history but add logo.webp:
- Don't delete original PNG yet (backup)
- Verify WebP loads correctly in dev
- Can delete PNG in next commit if all works

Why remove priority: Only LCP (Largest Contentful Paint) images should use priority. Sidebar logo is not the main content users see first. Why WebP: Typically 25-35% smaller than PNG with same quality.
  </action>
  <verify>logo.webp exists in public/images/, Sidebar shows logo correctly, file size is smaller than original PNG</verify>
  <done>Logo converted to WebP, image tags updated, no priority flag on non-critical images</done>
</task>

<task type="auto">
  <name>Task 2: Create skeleton loading components for all major sections</name>
  <files>src/components/ui/Skeleton.tsx, src/components/skeletons/ConversationListSkeleton.tsx, src/components/skeletons/ChatViewSkeleton.tsx, src/components/skeletons/AgentCardSkeleton.tsx, src/components/skeletons/DashboardSkeleton.tsx</files>
  <action>
Create skeleton components following responsive patterns from Phase 15-18:

1. **Base Skeleton component:**
```tsx
// src/components/ui/Skeleton.tsx
'use client';

import { cn } from '@/lib/utils';

export function Skeleton({ className }: { className?: string }) {
  return (
    <div
      className={cn(
        "animate-pulse bg-gray-200 dark:bg-slate-700 rounded",
        className
      )}
    />
  );
}
```

2. **ConversationListSkeleton.tsx:**
```tsx
'use client';

import { Skeleton } from '@/components/ui/Skeleton';

export function ConversationListSkeleton() {
  return (
    <div className="space-y-3 p-4">
      {[...Array(6)].map((_, i) => (
        <div key={i} className="flex items-start gap-3 min-h-[72px]">
          <Skeleton className="w-12 h-12 rounded-full flex-shrink-0" />
          <div className="flex-1 space-y-2">
            <Skeleton className="h-4 w-2/3" />
            <Skeleton className="h-3 w-full" />
            <Skeleton className="h-3 w-1/4" />
          </div>
        </div>
      ))}
    </div>
  );
}
```

3. **ChatViewSkeleton.tsx:**
```tsx
'use client';

import { Skeleton } from '@/components/ui/Skeleton';

export function ChatViewSkeleton() {
  return (
    <div className="flex-1 flex flex-col">
      {/* Header */}
      <div className="border-b p-4 flex items-center gap-3">
        <Skeleton className="w-10 h-10 rounded-full" />
        <div className="flex-1 space-y-2">
          <Skeleton className="h-4 w-1/3" />
          <Skeleton className="h-3 w-1/4" />
        </div>
      </div>

      {/* Messages */}
      <div className="flex-1 p-4 space-y-4">
        {[...Array(4)].map((_, i) => (
          <div key={i} className={i % 2 === 0 ? "flex justify-end" : "flex justify-start"}>
            <Skeleton className="h-16 w-3/4 max-w-[85%] rounded-2xl" />
          </div>
        ))}
      </div>

      {/* Input */}
      <div className="border-t p-4">
        <Skeleton className="h-12 w-full rounded-lg" />
      </div>
    </div>
  );
}
```

4. **AgentCardSkeleton.tsx:**
```tsx
'use client';

import { Skeleton } from '@/components/ui/Skeleton';

export function AgentCardSkeleton() {
  return (
    <div className="border rounded-lg p-4 sm:p-6 space-y-4">
      <div className="flex items-start gap-3">
        <Skeleton className="w-12 h-12 rounded-lg" />
        <div className="flex-1 space-y-2">
          <Skeleton className="h-5 w-2/3" />
          <Skeleton className="h-4 w-full" />
        </div>
      </div>
      <div className="flex gap-2">
        <Skeleton className="h-10 flex-1" />
        <Skeleton className="h-10 flex-1" />
      </div>
    </div>
  );
}
```

5. **DashboardSkeleton.tsx** (for charts and stats):
```tsx
'use client';

import { Skeleton } from '@/components/ui/Skeleton';

export function DashboardSkeleton() {
  return (
    <div className="space-y-6 p-4 sm:p-6 lg:p-8">
      {/* Stats grid */}
      <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
        {[...Array(4)].map((_, i) => (
          <Skeleton key={i} className="h-24 rounded-lg" />
        ))}
      </div>

      {/* Charts */}
      <div className="grid gap-6">
        <Skeleton className="h-64 rounded-lg" />
        <Skeleton className="h-48 rounded-lg" />
      </div>
    </div>
  );
}
```

Use responsive patterns (p-4 sm:p-6, grid-cols-2 md:grid-cols-4) matching Phase 15-18 implementations. Ensure min-h-[72px] for list items (Phase 17 touch target pattern).
  </action>
  <verify>5 skeleton components created, each renders loading state matching final UI layout, no console errors</verify>
  <done>Complete skeleton component library created covering all major app sections with responsive layouts</done>
</task>

<task type="auto">
  <name>Task 3: Implement Suspense boundaries for async data loading</name>
  <files>src/app/(main)/inbox/page.tsx, src/app/(main)/agents/page.tsx, src/app/(main)/dashboard/page.tsx</files>
  <action>
Add Suspense boundaries with skeleton fallbacks to key pages:

**Inbox page.tsx:**
```tsx
import { Suspense } from 'react';
import { ConversationListSkeleton } from '@/components/skeletons/ConversationListSkeleton';
import { ChatViewSkeleton } from '@/components/skeletons/ChatViewSkeleton';

export default function InboxPage() {
  return (
    <div className="flex h-full">
      <Suspense fallback={<ConversationListSkeleton />}>
        <ConversationList />
      </Suspense>

      <Suspense fallback={<ChatViewSkeleton />}>
        <ChatView />
      </Suspense>

      {/* Context panel - no suspense needed (optional UI) */}
    </div>
  );
}
```

**Agents page.tsx:**
```tsx
import { Suspense } from 'react';
import { AgentCardSkeleton } from '@/components/skeletons/AgentCardSkeleton';

export default function AgentsPage() {
  return (
    <div className="...">
      <Suspense fallback={
        <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
          {[...Array(6)].map((_, i) => (
            <AgentCardSkeleton key={i} />
          ))}
        </div>
      }>
        <AgentGrid />
      </Suspense>
    </div>
  );
}
```

**Dashboard page.tsx:**
```tsx
import { Suspense } from 'react';
import { DashboardSkeleton } from '@/components/skeletons/DashboardSkeleton';
import { ChartSkeleton } from '@/components/charts/ChartSkeleton';

export default function DashboardPage() {
  return (
    <Suspense fallback={<DashboardSkeleton />}>
      <DashboardContent />
    </Suspense>
  );
}
```

Note: If pages don't currently have async data fetching (using mock data), Suspense won't trigger. That's OK - we're establishing the pattern for when real async data is added. The main benefit right now is showing skeletons during chart chunk loading (from Plan 02).

Why Suspense: Provides automatic loading states during async operations. Prevents layout shift (CLS) by reserving space with skeleton. Better UX than spinners or blank screens.
  </action>
  <verify>Build succeeds, Suspense boundaries added to 3 key pages, skeleton components imported correctly</verify>
  <done>Suspense boundaries implemented with appropriate skeleton fallbacks, pattern established for future async data</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Logo displays correctly in Sidebar (WebP format)
- [ ] All 5 skeleton components render without errors
- [ ] Suspense boundaries added to Inbox, Agents, Dashboard pages
- [ ] No layout shift (CLS) when loading skeletons
- [ ] WebP image is smaller than original PNG
</verification>

<success_criteria>

- Logo converted to WebP with smaller file size
- Image loading optimized (no priority on non-LCP)
- Complete skeleton component library created
- Suspense boundaries implemented on key pages
- Loading states prevent layout shift
- Pattern established for future async features
</success_criteria>

<output>
After completion, create `.planning/phases/19-performance-polish/19-03-SUMMARY.md`:

# Phase 19-03 Summary: Image & Asset Optimization

**Optimized images and implemented comprehensive skeleton loading system.**

## Accomplishments

- Converted logo PNG to WebP format
- Removed priority flag from non-critical images
- Created 5 skeleton components for major UI sections
- Implemented Suspense boundaries on Inbox, Agents, Dashboard
- Established loading state pattern for future async data

## Files Created/Modified

- `public/images/logo.webp` - Optimized logo (WebP format)
- `src/components/ui/Skeleton.tsx` - Base skeleton component
- `src/components/skeletons/ConversationListSkeleton.tsx` - Inbox list loading
- `src/components/skeletons/ChatViewSkeleton.tsx` - Chat view loading
- `src/components/skeletons/AgentCardSkeleton.tsx` - Agent card loading
- `src/components/skeletons/DashboardSkeleton.tsx` - Dashboard loading
- `src/components/layout/Sidebar.tsx` - WebP logo, removed priority
- `src/app/(main)/inbox/page.tsx` - Added Suspense boundaries
- `src/app/(main)/agents/page.tsx` - Added Suspense boundaries
- `src/app/(main)/dashboard/page.tsx` - Added Suspense boundaries

## Decisions Made

- WebP for logo (25-35% smaller, broad browser support)
- No priority on sidebar logo (not LCP element)
- Skeleton components follow responsive patterns from Phase 15-18
- Suspense pattern for future async data integration

## Performance Impact

- Image payload reduction: ~XX KB (logo PNG â†’ WebP)
- CLS improvement: Skeleton states prevent layout shift
- Perceived performance: Immediate visual feedback during loading

## Issues Encountered

[Note any issues, or "None"]

## Next Step

Ready for 19-04-PLAN.md: Performance CI & Polish
</output>
